{"version":3,"file":"index.js","sources":["../src/index.js"],"sourcesContent":["import {\n  createContext,\n  useContext,\n  useState,\n  useEffect,\n  useCallback,\n} from \"react\";\n\nlet context = createContext();\nlet { Provider } = context;\n\nexport const useDiscord = () => useContext(context);\n\nexport const DiscordProvider = ({ redirectUri, discordClientId, discordClientSecret, children }) => {\n\n  const [discordUser, setDiscordUser] = useState(null);\n  const [oauthData, setOauthData] = useState(null);\n  const [loadingDiscordUserData, setLoadingDiscordUserData] = useState(false);\n  const [code, setCode] = useState(null);\n\n  useEffect(() => {\n    const searchParams = new URLSearchParams(document.location.search);\n    const c = searchParams.get('code');\n    if (c !== null && c !== \"\") setCode(c);\n  }, []);\n\n  const getUserFromDiscord = useCallback(async (token_type, access_token) => {\n    try {\n      setLoadingDiscordUserData(true);\n      const response = await fetch(\"https://discord.com/api/users/@me\", {\n        headers: {\n          Authorization: `${token_type} ${access_token}`,\n        },\n      });\n      if (response.status === 200) {\n        const userResult = await response.json();\n        setLoadingDiscordUserData(false);\n        setDiscordUser(userResult);\n        return userResult;\n      } else if (response.status === 401) {\n        setLoadingDiscordUserData(false);\n      }\n    } catch (e) {\n      setLoadingDiscordUserData(false);\n      throw e;\n    }\n  }, []);\n\n  const clearUserState = useCallback(() => {\n    setDiscordUser(null);\n  });\n\n  const getTokenFromDiscord = useCallback(async () => {\n    try {\n      const oauthResult = await fetch(\"https://discord.com/api/oauth2/token\", {\n        method: \"POST\",\n        body: new URLSearchParams({\n          client_id: discordClientId,\n          client_secret: discordClientSecret,\n          code: code,\n          grant_type: \"authorization_code\",\n          redirect_uri: redirectUri,\n          scope: \"identify\",\n        })\n      }).then(response => response.json());\n\n      setOauthData(oauthResult);\n      return oauthResult;\n    } catch (e) {\n      throw e;\n    }\n  }, [code]);\n\n  const refreshTokenFromDiscord = useCallback(async (refresh_token) => {\n    try {\n      const oauthResult = await fetch(\"https://discord.com/api/oauth2/token\", {\n        method: \"POST\",\n        body: new URLSearchParams({\n          client_id: discordClientId,\n          client_secret: discordClientSecret,\n          grant_type: \"refresh_token\",\n          refresh_token: refresh_token,\n        }),\n        headers: {\n          'Content-Type': 'application/x-www-form-urlencoded'\n        }\n      }).then(response => response.json());\n\n      setOauthData(oauthResult);\n\n      return oauthResult;\n    } catch (err) {\n      throw err;\n    }\n  }, []);\n\n  const loginWithDiscord = (scope) => {\n    if (!scope || typeof scope === \"object\") {\n      scope = \"identify email guilds.join\";\n    }\n    window.location.replace(\n      `https://discord.com/api/oauth2/authorize?${new URLSearchParams({\n        client_id: discordClientId,\n        redirect_uri: redirectUri,\n        response_type: \"code\",\n        scope,\n      }).toString()}`\n    );\n  };\n\n  useEffect(() => {\n    const getData = async () => {\n      try {\n        const oauthData = await getTokenFromDiscord();\n        await getUserFromDiscord(oauthData.token_type, oauthData.access_token);\n      } catch (err) {}\n    };\n\n    if (code) getData();\n  }, [code, getTokenFromDiscord, getUserFromDiscord]);\n\n  return (\n    <Provider\n      value={{\n        loginWithDiscord,\n        discordUser,\n        clearUserState,\n        oauthData,\n        loadingDiscordUserData,\n        getUserFromDiscord,\n        refreshTokenFromDiscord,\n      }}\n    >\n      {children}\n    </Provider>\n  );\n}\n"],"names":["context","createContext","Provider","useDiscord","useContext","DiscordProvider","redirectUri","discordClientId","discordClientSecret","children","useState","discordUser","setDiscordUser","oauthData","setOauthData","loadingDiscordUserData","setLoadingDiscordUserData","code","setCode","useEffect","searchParams","URLSearchParams","document","location","search","c","get","getUserFromDiscord","useCallback","token_type","access_token","fetch","headers","Authorization","response","status","json","userResult","clearUserState","getTokenFromDiscord","method","body","client_id","client_secret","grant_type","redirect_uri","scope","then","oauthResult","refreshTokenFromDiscord","refresh_token","loginWithDiscord","window","replace","response_type","toString","getData","_jsx"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAQA,IAAIA,OAAO,gBAAGC,mBAAa,EAA3B;AACA,IAAMC,QAAN,GAAmBF,OAAnB,CAAME,QAAN;IAEaC,UAAU,GAAG,SAAbA,UAAa;AAAA,SAAMC,gBAAU,CAACJ,OAAD,CAAhB;AAAA;IAEbK,eAAe,GAAG,SAAlBA,eAAkB,OAAqE;AAAA,MAAlEC,WAAkE,QAAlEA,WAAkE;AAAA,MAArDC,eAAqD,QAArDA,eAAqD;AAAA,MAApCC,mBAAoC,QAApCA,mBAAoC;AAAA,MAAfC,QAAe,QAAfA,QAAe;;AAElG,kBAAsCC,cAAQ,CAAC,IAAD,CAA9C;AAAA;AAAA,MAAOC,WAAP;AAAA,MAAoBC,cAApB;;AACA,mBAAkCF,cAAQ,CAAC,IAAD,CAA1C;AAAA;AAAA,MAAOG,SAAP;AAAA,MAAkBC,YAAlB;;AACA,mBAA4DJ,cAAQ,CAAC,KAAD,CAApE;AAAA;AAAA,MAAOK,sBAAP;AAAA,MAA+BC,yBAA/B;;AACA,mBAAwBN,cAAQ,CAAC,IAAD,CAAhC;AAAA;AAAA,MAAOO,IAAP;AAAA,MAAaC,OAAb;;AAEAC,EAAAA,eAAS,CAAC,YAAM;AACd,QAAMC,YAAY,GAAG,IAAIC,eAAJ,CAAoBC,QAAQ,CAACC,QAAT,CAAkBC,MAAtC,CAArB;AACA,QAAMC,CAAC,GAAGL,YAAY,CAACM,GAAb,CAAiB,MAAjB,CAAV;AACA,QAAID,CAAC,KAAK,IAAN,IAAcA,CAAC,KAAK,EAAxB,EAA4BP,OAAO,CAACO,CAAD,CAAP;AAC7B,GAJQ,EAIN,EAJM,CAAT;AAMA,MAAME,kBAAkB,GAAGC,iBAAW;AAAA,wEAAC,iBAAOC,UAAP,EAAmBC,YAAnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEnCd,cAAAA,yBAAyB,CAAC,IAAD,CAAzB;AAFmC;AAAA,qBAGZe,KAAK,CAAC,mCAAD,EAAsC;AAChEC,gBAAAA,OAAO,EAAE;AACPC,kBAAAA,aAAa,YAAKJ,UAAL,cAAmBC,YAAnB;AADN;AADuD,eAAtC,CAHO;;AAAA;AAG7BI,cAAAA,QAH6B;;AAAA,oBAQ/BA,QAAQ,CAACC,MAAT,KAAoB,GARW;AAAA;AAAA;AAAA;;AAAA;AAAA,qBASRD,QAAQ,CAACE,IAAT,EATQ;;AAAA;AAS3BC,cAAAA,UAT2B;AAUjCrB,cAAAA,yBAAyB,CAAC,KAAD,CAAzB;AACAJ,cAAAA,cAAc,CAACyB,UAAD,CAAd;AAXiC,+CAY1BA,UAZ0B;;AAAA;AAa5B,kBAAIH,QAAQ,CAACC,MAAT,KAAoB,GAAxB,EAA6B;AAClCnB,gBAAAA,yBAAyB,CAAC,KAAD,CAAzB;AACD;;AAfkC;AAAA;AAAA;;AAAA;AAAA;AAAA;AAiBnCA,cAAAA,yBAAyB,CAAC,KAAD,CAAzB;AAjBmC;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAD;;AAAA;AAAA;AAAA;AAAA,OAoBnC,EApBmC,CAAtC;AAsBA,MAAMsB,cAAc,GAAGV,iBAAW,CAAC,YAAM;AACvChB,IAAAA,cAAc,CAAC,IAAD,CAAd;AACD,GAFiC,CAAlC;AAIA,MAAM2B,mBAAmB,GAAGX,iBAAW,uEAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBAEVG,KAAK,CAAC,sCAAD,EAAyC;AACtES,cAAAA,MAAM,EAAE,MAD8D;AAEtEC,cAAAA,IAAI,EAAE,IAAIpB,eAAJ,CAAoB;AACxBqB,gBAAAA,SAAS,EAAEnC,eADa;AAExBoC,gBAAAA,aAAa,EAAEnC,mBAFS;AAGxBS,gBAAAA,IAAI,EAAEA,IAHkB;AAIxB2B,gBAAAA,UAAU,EAAE,oBAJY;AAKxBC,gBAAAA,YAAY,EAAEvC,WALU;AAMxBwC,gBAAAA,KAAK,EAAE;AANiB,eAApB;AAFgE,aAAzC,CAAL,CAUvBC,IAVuB,CAUlB,UAAAb,QAAQ;AAAA,qBAAIA,QAAQ,CAACE,IAAT,EAAJ;AAAA,aAVU,CAFU;;AAAA;AAE9BY,YAAAA,WAF8B;AAcpClC,YAAAA,YAAY,CAACkC,WAAD,CAAZ;AAdoC,8CAe7BA,WAf6B;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAD,IAmBpC,CAAC/B,IAAD,CAnBoC,CAAvC;AAqBA,MAAMgC,uBAAuB,GAAGrB,iBAAW;AAAA,wEAAC,kBAAOsB,aAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBAEdnB,KAAK,CAAC,sCAAD,EAAyC;AACtES,gBAAAA,MAAM,EAAE,MAD8D;AAEtEC,gBAAAA,IAAI,EAAE,IAAIpB,eAAJ,CAAoB;AACxBqB,kBAAAA,SAAS,EAAEnC,eADa;AAExBoC,kBAAAA,aAAa,EAAEnC,mBAFS;AAGxBoC,kBAAAA,UAAU,EAAE,eAHY;AAIxBM,kBAAAA,aAAa,EAAEA;AAJS,iBAApB,CAFgE;AAQtElB,gBAAAA,OAAO,EAAE;AACP,kCAAgB;AADT;AAR6D,eAAzC,CAAL,CAWvBe,IAXuB,CAWlB,UAAAb,QAAQ;AAAA,uBAAIA,QAAQ,CAACE,IAAT,EAAJ;AAAA,eAXU,CAFc;;AAAA;AAElCY,cAAAA,WAFkC;AAexClC,cAAAA,YAAY,CAACkC,WAAD,CAAZ;AAfwC,gDAiBjCA,WAjBiC;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAD;;AAAA;AAAA;AAAA;AAAA,OAqBxC,EArBwC,CAA3C;;AAuBA,MAAMG,gBAAgB,GAAG,SAAnBA,gBAAmB,CAACL,KAAD,EAAW;AAClC,QAAI,CAACA,KAAD,IAAU,QAAOA,KAAP,MAAiB,QAA/B,EAAyC;AACvCA,MAAAA,KAAK,GAAG,4BAAR;AACD;;AACDM,IAAAA,MAAM,CAAC7B,QAAP,CAAgB8B,OAAhB,oDAC8C,IAAIhC,eAAJ,CAAoB;AAC9DqB,MAAAA,SAAS,EAAEnC,eADmD;AAE9DsC,MAAAA,YAAY,EAAEvC,WAFgD;AAG9DgD,MAAAA,aAAa,EAAE,MAH+C;AAI9DR,MAAAA,KAAK,EAALA;AAJ8D,KAApB,EAKzCS,QALyC,EAD9C;AAQD,GAZD;;AAcApC,EAAAA,eAAS,CAAC,YAAM;AACd,QAAMqC,OAAO;AAAA,0EAAG;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBAEYjB,mBAAmB,EAF/B;;AAAA;AAEN1B,gBAAAA,UAFM;AAAA;AAAA,uBAGNc,kBAAkB,CAACd,UAAS,CAACgB,UAAX,EAAuBhB,UAAS,CAACiB,YAAjC,CAHZ;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAAH;;AAAA,sBAAP0B,OAAO;AAAA;AAAA;AAAA,OAAb;;AAOA,QAAIvC,IAAJ,EAAUuC,OAAO;AAClB,GATQ,EASN,CAACvC,IAAD,EAAOsB,mBAAP,EAA4BZ,kBAA5B,CATM,CAAT;AAWA,sBACE8B,eAAC,QAAD;AACE,IAAA,KAAK,EAAE;AACLN,MAAAA,gBAAgB,EAAhBA,gBADK;AAELxC,MAAAA,WAAW,EAAXA,WAFK;AAGL2B,MAAAA,cAAc,EAAdA,cAHK;AAILzB,MAAAA,SAAS,EAATA,SAJK;AAKLE,MAAAA,sBAAsB,EAAtBA,sBALK;AAMLY,MAAAA,kBAAkB,EAAlBA,kBANK;AAOLsB,MAAAA,uBAAuB,EAAvBA;AAPK,KADT;AAAA,cAWGxC;AAXH,IADF;AAeD;;;;;"}