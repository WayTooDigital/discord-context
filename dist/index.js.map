{"version":3,"file":"index.js","sources":["../src/index.js"],"sourcesContent":["import {\n  createContext,\n  useContext,\n  useState,\n  useEffect,\n  useCallback,\n} from \"react\";\nimport { useRouter } from \"next/router\";\nimport axios from \"axios\";\n\nlet context = createContext();\nlet { Provider } = context;\n\nexport const useDiscord = () => useContext(context);\n\nexport const DiscordProvider = ({ redirectUri, discordClientId, discordClientSecret, children }) => {\n\n  const [discordUser, setDiscordUser] = useState(null);\n  const [oauthData, setOauthData] = useState(null);\n  const [loadingDiscordUserData, setLoadingDiscordUserData] = useState(false);\n  const router = useRouter();\n  const code = router.query.code;\n\n  const getUserFromDiscord = useCallback(async (token_type, access_token) => {\n    try {\n      setLoadingDiscordUserData(true);\n      const userResult = await axios.get(\"https://discord.com/api/users/@me\", {\n        headers: {\n          Authorization: `${token_type} ${access_token}`,\n        },\n      });\n      setLoadingDiscordUserData(false);\n      setDiscordUser(userResult.data);\n      return userResult.data;\n    } catch (e) {\n      setLoadingDiscordUserData(false);\n      throw e;\n    }\n  }, []);\n\n  const clearUserState = () => {\n    setDiscordUser(null);\n  };\n\n  const getTokenFromDiscord = useCallback(async () => {\n    try {\n      const oauthResult = await axios.post(\n        \"https://discord.com/api/oauth2/token\",\n        new URLSearchParams({\n          client_id: discordClientId,\n          client_secret: discordClientSecret,\n          code: code,\n          grant_type: \"authorization_code\",\n          redirect_uri: redirectUri,\n          scope: \"identify\",\n        })\n      );\n\n      setOauthData(oauthResult.data);\n      return oauthResult.data;\n    } catch (e) {\n      throw e;\n    }\n  }, [code]);\n\n  const loginWithDiscord = () => {\n    router.push(\n      `https://discord.com/api/oauth2/authorize?${new URLSearchParams({\n        client_id: discordClientId,\n        redirect_uri: redirectUri,\n        response_type: \"code\",\n        scope: \"identify email guilds.join\",\n      }).toString()}`\n    );\n  };\n\n  useEffect(() => {\n    const getData = async () => {\n      try {\n        const oauthData = await getTokenFromDiscord();\n        await getUserFromDiscord(oauthData.token_type, oauthData.access_token);\n      } catch (err) {}\n    };\n\n    if (code) getData();\n  }, [code, router, getTokenFromDiscord, getUserFromDiscord]);\n\n  return (\n    <Provider\n      value={{\n        loginWithDiscord,\n        discordUser,\n        clearUserState,\n        oauthData,\n        loadingDiscordUserData,\n        getUserFromDiscord,\n      }}\n    >\n      {children}\n    </Provider>\n  );\n}\n"],"names":["context","createContext","Provider","useDiscord","useContext","DiscordProvider","redirectUri","discordClientId","discordClientSecret","children","useState","discordUser","setDiscordUser","oauthData","setOauthData","loadingDiscordUserData","setLoadingDiscordUserData","router","useRouter","code","query","getUserFromDiscord","useCallback","token_type","access_token","axios","get","headers","Authorization","userResult","data","clearUserState","getTokenFromDiscord","post","URLSearchParams","client_id","client_secret","grant_type","redirect_uri","scope","oauthResult","loginWithDiscord","push","response_type","toString","useEffect","getData","_jsx"],"mappings":"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"}