{"version":3,"file":"index.es.js","sources":["../src/index.js"],"sourcesContent":["import {\n  createContext,\n  useContext,\n  useState,\n  useEffect,\n  useCallback,\n} from \"react\";\n\nlet context = createContext();\nlet { Provider } = context;\n\nexport const useDiscord = () => useContext(context);\n\nexport const DiscordProvider = ({ redirectUri, discordClientId, discordClientSecret, children }) => {\n\n  const [discordUser, setDiscordUser] = useState(null);\n  const [oauthData, setOauthData] = useState(null);\n  const [loadingDiscordUserData, setLoadingDiscordUserData] = useState(false);\n  const [code, setCode] = useState(null);\n\n  useEffect(() => {\n    const searchParams = new URLSearchParams(document.location.search);\n    const c = searchParams.get('code');\n    if (c !== null && c !== \"\") setCode(c);\n  }, []);\n\n  const getUserFromDiscord = useCallback(async (token_type, access_token) => {\n    try {\n      setLoadingDiscordUserData(true);\n      const userResult = await fetch(\"https://discord.com/api/users/@me\", {\n        headers: {\n          Authorization: `${token_type} ${access_token}`,\n        },\n      }).then(response => response.json());\n      setLoadingDiscordUserData(false);\n      setDiscordUser(userResult);\n      return userResult;\n    } catch (e) {\n      setLoadingDiscordUserData(false);\n      throw e;\n    }\n  }, []);\n\n  const clearUserState = useCallback(() => {\n    setDiscordUser(null);\n  });\n\n  const getTokenFromDiscord = useCallback(async () => {\n    try {\n      const oauthResult = await fetch(\"https://discord.com/api/oauth2/token\", {\n        method: \"POST\",\n        body: new URLSearchParams({\n          client_id: discordClientId,\n          client_secret: discordClientSecret,\n          code: code,\n          grant_type: \"authorization_code\",\n          redirect_uri: redirectUri,\n          scope: \"identify\",\n        })\n      }).then(response => response.json());\n\n      setOauthData(oauthResult);\n      return oauthResult;\n    } catch (e) {\n      throw e;\n    }\n  }, [code]);\n\n  const loginWithDiscord = () => {\n    window.location.replace(\n      `https://discord.com/api/oauth2/authorize?${new URLSearchParams({\n        client_id: discordClientId,\n        redirect_uri: redirectUri,\n        response_type: \"code\",\n        scope: \"identify email guilds.join\",\n      }).toString()}`\n    );\n  };\n\n  useEffect(() => {\n    const getData = async () => {\n      try {\n        const oauthData = await getTokenFromDiscord();\n        await getUserFromDiscord(oauthData.token_type, oauthData.access_token);\n      } catch (err) {}\n    };\n\n    if (code) getData();\n  }, [code, getTokenFromDiscord, getUserFromDiscord]);\n\n  return (\n    <Provider\n      value={{\n        loginWithDiscord,\n        discordUser,\n        clearUserState,\n        oauthData,\n        loadingDiscordUserData,\n        getUserFromDiscord,\n      }}\n    >\n      {children}\n    </Provider>\n  );\n}\n"],"names":["context","createContext","Provider","useDiscord","useContext","DiscordProvider","redirectUri","discordClientId","discordClientSecret","children","useState","discordUser","setDiscordUser","oauthData","setOauthData","loadingDiscordUserData","setLoadingDiscordUserData","code","setCode","useEffect","searchParams","URLSearchParams","document","location","search","c","get","getUserFromDiscord","useCallback","token_type","access_token","fetch","headers","Authorization","then","response","json","userResult","clearUserState","getTokenFromDiscord","method","body","client_id","client_secret","grant_type","redirect_uri","scope","oauthResult","loginWithDiscord","window","replace","response_type","toString","getData","_jsx"],"mappings":"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"}